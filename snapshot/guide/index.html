<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut AWS</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li class='desktop'><select style='margin-top: 10px' onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option selected='selected' value='https://micronaut-projects.github.io/micronaut-aws/snapshot/guide/index.html'>1.3.8.BUILD-SNAPSHOT</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.7/guide/index.html'>1.3.7</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.6/guide/index.html'>1.3.6</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.5/guide/index.html'>1.3.5</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.4/guide/index.html'>1.3.4</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.3/guide/index.html'>1.3.3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.2/guide/index.html'>1.3.2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.1/guide/index.html'>1.3.1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.0/guide/index.html'>1.3.0</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.2/guide/index.html'>1.1.2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.1/guide/index.html'>1.1.1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0/guide/index.html'>1.1.0</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.RC3/guide/index.html'>1.1.0.RC3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.RC2/guide/index.html'>1.1.0.RC2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.RC1/guide/index.html'>1.1.0.RC1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.M2/guide/index.html'>1.1.0.M2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.M1/guide/index.html'>1.1.0.M1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.3/guide/index.html'>1.0.3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.2/guide/index.html'>1.0.2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.1/guide/index.html'>1.0.1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0/guide/index.html'>1.0.0</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.RC3/guide/index.html'>1.0.0.RC3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.RC2/guide/index.html'>1.0.0.RC2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.RC1/guide/index.html'>1.0.0.RC1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.M4/guide/index.html'>1.0.0.M4</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.M3/guide/index.html'>1.0.0.M3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.M2/guide/index.html'>1.0.0.M2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.M1/guide/index.html'>1.0.0.M1</option></select></li><li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#awsCredentialsProvider"><strong>2</strong><span>AWS Credentials Provider</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#lambda"><strong>3</strong><span>AWS Lambda Support</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#alexa"><strong>4</strong><span>Alexa Skill Support</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#repository"><strong>5</strong><span>Repository</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-awsCredentialsProvider"><a href="#awsCredentialsProvider"><strong>2</strong><span>AWS Credentials Provider</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-lambda"><a href="#lambda"><strong>3</strong><span>AWS Lambda Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-requestHandlers"><a href="#requestHandlers"><strong>3.1</strong><span>Micronaut Request Handlers</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-apiProxy"><a href="#apiProxy"><strong>3.2</strong><span>AWS API Gateway Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-customRuntimes"><a href="#customRuntimes"><strong>3.3</strong><span>AWS Lambda Custom Runtimes</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-alexa"><a href="#alexa"><strong>4</strong><span>Alexa Skill Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-intentHandler"><a href="#intentHandler"><strong>4.1</strong><span>The IntentHandler Annotation</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-repository"><a href="#repository"><strong>5</strong><span>Repository</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut AWS</h1>
        <p></p>
        <p>Provides integration between Micronaut and Amazon Web Services (AWS)</p>
        <p><strong>Version:</strong> <select style='margin-top: 10px' onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option selected='selected' value='https://micronaut-projects.github.io/micronaut-aws/snapshot/guide/index.html'>1.3.8.BUILD-SNAPSHOT</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.7/guide/index.html'>1.3.7</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.6/guide/index.html'>1.3.6</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.5/guide/index.html'>1.3.5</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.4/guide/index.html'>1.3.4</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.3/guide/index.html'>1.3.3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.2/guide/index.html'>1.3.2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.1/guide/index.html'>1.3.1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.3.0/guide/index.html'>1.3.0</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.2/guide/index.html'>1.1.2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.1/guide/index.html'>1.1.1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0/guide/index.html'>1.1.0</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.RC3/guide/index.html'>1.1.0.RC3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.RC2/guide/index.html'>1.1.0.RC2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.RC1/guide/index.html'>1.1.0.RC1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.M2/guide/index.html'>1.1.0.M2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.1.0.M1/guide/index.html'>1.1.0.M1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.3/guide/index.html'>1.0.3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.2/guide/index.html'>1.0.2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.1/guide/index.html'>1.0.1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0/guide/index.html'>1.0.0</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.RC3/guide/index.html'>1.0.0.RC3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.RC2/guide/index.html'>1.0.0.RC2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.RC1/guide/index.html'>1.0.0.RC1</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.M4/guide/index.html'>1.0.0.M4</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.M3/guide/index.html'>1.0.0.M3</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.M2/guide/index.html'>1.0.0.M2</option><option value='https://micronaut-projects.github.io/micronaut-aws/1.0.0.M1/guide/index.html'>1.0.0.M1</option></select></p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This project provides various extensions to Micronaut for Amazon Web Services (AWS). The primary focus initially is on AWS Lambda, however other integrations may be included in this project in the future.</p>
</div>
<div class="paragraph">
<p>A base <a href="../api/io/micronaut/configuration/aws/AWSClientConfiguration.html">AWSClientConfiguration</a> is provided which can be used as a base configuration class for any configuration that needs to configure an AWS SDK client.</p>
</div>
<div class="sect3">
<h4 id="_release_history">Release History</h4>
<div class="sect4">
<h5 id="_1_0">1.0</h5>
<div class="paragraph">
<p>Initial Release</p>
</div>
</div>
<div class="sect4">
<h5 id="_1_1">1.1</h5>
<div class="paragraph">
<p>Compatibility with Micronaut 1.1</p>
</div>
</div>
<div class="sect4">
<h5 id="_1_2">1.2</h5>
<div class="paragraph">
<p>Compatibility with Micronaut 1.2</p>
</div>
</div>
<div class="sect4">
<h5 id="_1_3">1.3</h5>
<div class="ulist">
<ul>
<li>
<p>Improved support for GraalVM native images</p>
</li>
<li>
<p>Upgrade to <code>aws-serverless-java-container-core</code> 1.4</p>
</li>
</ul>
</div>
</div>
</div>

<h1 id="awsCredentialsProvider"><a class="anchor" href="#awsCredentialsProvider"></a>2 AWS Credentials Provider</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/awsCredentialsProvider.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When working with AWS SDK, you may need to provide a <code>com.amazonaws.auth.AWSCredentialsProvider</code>. To ease that this module provides a utility class: <a href="../api/io/micronaut/configuration/aws/EnvironmentAWSCredentialsProvider.html">EnvironmentAWSCredentialsProvider</a>.</p>
</div>
<div class="paragraph">
<p>For example the following snippet show how you may configure a S3 Client if you set two environment variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export AWS_ACCESS_KEY_ID=XXXX
export AWS_SECRET_KEY=YYYY</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AmazonS3ClientBuilder amazonS3ClientBuilder = AmazonS3ClientBuilder.standard();
  amazonS3ClientBuilder.setCredentials(new EnvironmentAWSCredentialsProvider(applicationContext.getEnvironment()));
AmazonS3 s3 = amazonS3ClientBuilder.build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read about <a href="https://docs.micronaut.io/latest/guide/index.html#propertySource">externalized Configuration with property sources</a> in Micronaut.</p>
</div>

<h1 id="lambda"><a class="anchor" href="#lambda"></a>3 AWS Lambda Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/lambda.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Regular Micronaut functions created via <code>mn create-function</code> can be deployed to Lambda directly.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-function example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, when using <code>create-function hello</code> Micronaut 1.1 and above will create a function that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package example;
import io.micronaut.function.executor.FunctionInitializer;
import javax.inject.*;

@Singleton
public class EchoFunction extends FunctionInitializer { <i class="conum" data-value="1"></i><b>(1)</b>

    @Inject GreetingService greetingService; <i class="conum" data-value="2"></i><b>(2)</b>

    public Message echo(Message msg) { <i class="conum" data-value="3"></i><b>(3)</b>
        return greetingService.hello(msg);
    }

    public static void main(String...args) throws IOException { <i class="conum" data-value="4"></i><b>(4)</b>
        EchoFunction function = new EchoFunction();
        function.run(args, (context)-&gt; function.echo(context.get(Message.class)));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The function should be a simple class annotated with <code>@Singleton</code> that extends from <code>FunctionInitializer</code> and has no constructor arguments.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use dependency injection to inject fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The function should be defined as a public method, and accept a single argument that is a simple <code>java.lang</code> type or a POJO bean that can be serialized/deserialized to JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can optionally define a <code>main</code> method if you plan to deploy the function to other FaaS environments that use standard in/out. If not, you can remove the <code>main</code> method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>FunctionInitiazer</code> super class will bootstrap Micronaut and perform injection on the instance prior to the <code>echo</code> method being executed.</p>
</div>
<div class="paragraph">
<p>An appropriate SAM definition for this function would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Resources:
  HelloFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: example.EchoFunction::echo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key part is the <code>Handler</code> which should be set to <code>example.EchoFunction::echo</code> which is the class name and method name combination. The <code>main</code> method is optional and can be removed if it is not needed. The <code>main</code> method allows the function to be executed from the cli, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ echo '{"name":"Fred"}' | java -jar function.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example pipes the JSON into system in which the functions reads and writes the result to system out. Certain FaaS systems such as OpenFaaS use system in/out for function inputs and outputs, hence with the main method in place you can deploy the function to such systems.</p>
</div>
<div class="paragraph">
<p>If you need further integration with what AWS Lambda has to offer, then this project includes a number of parent classes and utilities to simplify working with the native Lambda APIs.</p>
</div>

<h2 id="requestHandlers"><a class="anchor" href="#requestHandlers"></a>3.1 Micronaut Request Handlers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/lambda/requestHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>micronaut-function-aws</code> module includes two parent classes you can subclass to implement native AWS Lambda functionality. To get started first add the <code>micronaut-function-aws</code> dependency to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut:micronaut-function-aws'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-function-aws&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>You can then use either <a href="../api/io/micronaut/function/aws/MicronautRequestHandler.html">MicronautRequestHandler</a> or <a href="../api/io/micronaut/function/aws/MicronautRequestStreamHandler.html">MicronautRequestStreamHandler</a> as your parent class to implement your Lambda handler. For example:</p>
</div>
<div class="listingblock">
<div class="title">Implementing <code>MicronautRequestHandler</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package example;

import io.micronaut.context.env.Environment;
import javax.inject.Inject;

public class RoundHandler extends MicronautRequestHandler&lt;Float, Integer&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    @Inject
    MathService mathService; <i class="conum" data-value="2"></i><b>(2)</b>

    @Inject
    Environment env;

    @Override
    public Integer execute(Float input) {
        return mathService.round(input); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class extends <a href="../api/io/micronaut/function/aws/MicronautRequestHandler.html">MicronautRequestHandler</a> and must have a default constructor.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use field injection to inject dependencies</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The function implementation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With <a href="../api/io/micronaut/function/aws/MicronautRequestHandler.html">MicronautRequestHandler</a> it is expected that you supply generic types with the input and the output types.</p>
</div>
<div class="paragraph">
<p>If you wish to work with raw streams then subclass <a href="../api/io/micronaut/function/aws/MicronautRequestStreamHandler.html">MicronautRequestStreamHandler</a> instead.</p>
</div>
<div class="paragraph">
<p>You should then configure the class name as the Lambda handler when deploying to AWS. For example with SAM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Resources:
  MyFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: example.RoundHandler::handleRequest</code></pre>
</div>
</div>

<h2 id="apiProxy"><a class="anchor" href="#apiProxy"></a>3.2 AWS API Gateway Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/lambda/apiProxy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>An alternative approach to using Micronaut with AWS is to use Micronaut support for the <a href="https://github.com/awslabs/aws-serverless-java-container">AWS Serverless Java Container</a> project.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI with Micronaut 1.1 or above</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features aws-api-gateway</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this arrangement you build your application as a regular REST application, for example:</p>
</div>
<div class="listingblock">
<div class="title">Example Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package example;

import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Controller("/ping")
public class PingController {

	private Logger log = LoggerFactory.getLogger(PingController.class);

    @Get("/")
    public String ping() {
    	log.trace("Received a ping.");
    	return "{\"pong\":true}";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You then need to add the <code>micronaut-function-aws-api-proxy</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut.aws:micronaut-function-aws-api-proxy'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.aws&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-function-aws-api-proxy&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>You can then implement a <code>RequestHandler</code> that handles the API proxy request:</p>
</div>
<div class="listingblock">
<div class="title">Example Stream Lambda Handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package example;

import com.amazonaws.serverless.exceptions.ContainerInitializationException;
import com.amazonaws.serverless.proxy.model.*;
import com.amazonaws.services.lambda.runtime.*;
import io.micronaut.function.aws.proxy.MicronautLambdaContainerHandler;
import java.io.*;

public class StreamLambdaHandler implements RequestStreamHandler {

    private MicronautLambdaContainerHandler handler;

    public StreamLambdaHandler() {
        try {
            handler = new MicronautLambdaContainerHandler(); <i class="conum" data-value="1"></i><b>(1)</b>
        } catch (ContainerInitializationException e) {
            // if we fail here. We re-throw the exception to force another cold start
            e.printStackTrace();
            throw new RuntimeException("Could not initialize Micronaut", e);
        }
    }

    @Override
    public void handleRequest(InputStream inputStream, OutputStream outputStream, Context context)
            throws IOException {
        handler.proxyStream(inputStream, outputStream, context); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Micronaut is initialized in the constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The API Proxy Request is handled</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/function/aws/proxy/MicronautLambdaContainerHandler.html">MicronautLambdaContainerHandler</a> class is used to initialization Micronaut and handle the serverless requests.</p>
</div>
<div class="paragraph">
<p>The <code>MicronautLambdaContainerHandler</code> constructor also accepts a <code>ApplicationContextBuilder</code> instance which you can use to further customize application bootstrap.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the <a href="https://github.com/micronaut-projects/micronaut-aws/tree/master/examples/api-gateway-example">Example Application</a> and associated <a href="https://github.com/micronaut-projects/micronaut-aws/blob/master/examples/api-gateway-example/README.md">README</a> for instructions on how to deploy locally using <a href="https://github.com/awslabs/aws-sam-cli">AWS SAM Local</a> and AWS Cloud Formation for production.
</td>
</tr>
</table>
</div>

<h2 id="customRuntimes"><a class="anchor" href="#customRuntimes"></a>3.3 AWS Lambda Custom Runtimes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/lambda/customRuntimes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may wish to implement a custom runtime, for example if you wish to use a different JVM than the one AWS provides.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/function/aws/runtime/MicronautLambdaRuntime.html">MicronautLambdaRuntime</a> class provides an implementation that you can use to execute a custom runtime. You need to add the <code>micronaut-function-aws-custom-runtime</code> dependency to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut.aws:micronaut-function-aws-custom-runtime'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.aws&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-function-aws-custom-runtime&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>The application should be built with using the <a href="#apiProxy">API Gateway</a> approach.</p>
</div>
<div class="sect2">
<h3 id="_custom_java_runtimes">Custom Java Runtimes</h3>
<div class="paragraph">
<p>Then create a <code>bootstrap</code> bash script. The following is an example <code>bootstrap</code></p>
</div>
<div class="listingblock">
<div class="title">Example <code>bootstrap</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/sh
set -euo pipefail
java -XX:TieredStopAtLevel=1 -noverify -cp server.jar io.micronaut.function.aws.runtime.MicronautLambdaRuntime</code></pre>
</div>
</div>
<div class="paragraph">
<p>You then need to create a zip bundle including the <code>bootstrap</code> and your application JAR filed (in the above case named <code>server.jar</code>) for deployment to AWS and specify a runtime of <code>provided</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws lambda create-function --function-name my-function \
--zip-file fileb://function.zip --handler function.handler --runtime provided \
--role arn:aws:iam::123456789:role/lambda_basic_execution</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See <a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-walkthrough.html">Publishing a Custom Runtime</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_custom_graalvm_native_runtimes">Custom GraalVM Native Runtimes</h3>
<div class="paragraph">
<p>To achieve the absolutely best cold startup time you can create an API Gateway application that is compiled into a native image and then run using a custom AWS Lambda Runtime. The quickest way to get started is with the Micronaut 1.1 or above CLI:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features aws-api-gateway-graal</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then create a controller, for example:</p>
</div>
<div class="listingblock">
<div class="title">Example Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package example;

import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Controller("/ping")
public class PingController {

	private Logger log = LoggerFactory.getLogger(PingController.class);

    @Get("/")
    public String ping() {
    	log.trace("Received a ping.");
    	return "{\"pong\":true}";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then use Docker to build a function ZIP file ready for deployment to AWS Lambda:</p>
</div>
<div class="listingblock">
<div class="title">Building the Function ZIP file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build . -t my-app
$ mkdir build
$ docker run --rm --entrypoint cat my-app  /home/application/function.zip &gt; build/function.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application can then be deployed to Lambda either via the AWS console or the CLI:</p>
</div>
<div class="listingblock">
<div class="title">Deploying the Function with the AWS CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ aws lambda create-function --function-name my-app \
--zip-file fileb://build/function.zip --handler function.handler --runtime provided \
--role arn:aws:iam::881337894647:role/lambda_basic_execution</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can invoke the function:</p>
</div>
<div class="listingblock">
<div class="title">Invoking the Function with the AWS CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ aws lambda invoke --function-name my-app --payload '{"resource": "/ping", "path": "/ping", "httpMethod": "GET"}' build/response.txt
$ cat build/response.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a complete, step-by-step guide about <a href="https://guides.micronaut.io/micronaut-function-graalvm-aws-lambda-gateway/guide/index.html">Micronaut Functions in GraalVM Native Images deployed to AWS Lambda</a>.</p>
</div>
<div class="paragraph">
<p>You can also check the sample application at the <a href="https://github.com/awslabs/aws-serverless-java-container/tree/master/samples/micronaut/pet-store">AWS Serverless Java container repository</a>.</p>
</div>
</div>

<h1 id="alexa"><a class="anchor" href="#alexa"></a>4 Alexa Skill Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/alexa.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>micronaut-function-aws-alexa</code> module includes support for building Alexa Skills with Micronaut:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut.aws:micronaut-function-aws-alexa'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.aws&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-function-aws-alexa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In Micronaut 1.1 or above you can create an Alexa Skills application with <code>mn create-function hello-alexa --provider alexa</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using Micronaut&#8217;s Alexa support you set your Lambda handler name to <a href="../api/io/micronaut/function/aws/alexa/AlexaFunction.html">AlexaFunction</a> class or a sublcass of this class if you plan to customize it.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/function/aws/alexa/AlexaFunction.html">AlexaFunction</a> will wire up your Alexa application and supports dependency injection of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.amazon.ask.dispatcher.request.handler.RequestHandler</code></p>
</li>
<li>
<p><code>com.amazon.ask.dispatcher.request.interceptor.RequestInterceptor</code></p>
</li>
<li>
<p><code>com.amazon.ask.dispatcher.exception.ExceptionHandler</code></p>
</li>
<li>
<p><code>com.amazon.ask.builder.SkillBuilder</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Simply declaring these types as beans will automatically configure the Alexa Skill appropriately.</p>
</div>
<div class="paragraph">
<p>To set the skill ID of your skill to enable skill verification, set the following property in Micronaut (application.yml or environment variable)
under the property name 'alexa.skill.id'.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can find sample applications in Java, Kotlin and Groovy in the <a href="https://github.com/micronaut-projects/micronaut-aws/tree/master/examples">Examples</a> directory of the repository.
</td>
</tr>
</table>
</div>

<h2 id="intentHandler"><a class="anchor" href="#intentHandler"></a>4.1 The IntentHandler Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/alexa/intentHandler.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To simplify the programming model Micronaut AWS includes a <a href="../api/io/micronaut/function/aws/alexa/annotation/IntentHandler.html">@IntentHandler</a> annotation that can be used on any bean method to make the method an intent handler.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The method must accept a single value of type <code>com.amazon.ask.dispatcher.request.handler.HandlerInput</code> and return a value of type <code>Optional&lt;com.amazon.ask.model.Response&gt;</code> otherwise a compilation error will occur.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A typical Alexa application written in Micronaut looks like:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import com.amazon.ask.dispatcher.request.handler.HandlerInput;
import com.amazon.ask.model.Response;
import io.micronaut.function.aws.alexa.AlexaIntents;
import io.micronaut.function.aws.alexa.annotation.IntentHandler;

import javax.inject.Singleton;
import java.util.Optional;

@Singleton <b class="conum">(1)</b>
public class AlexaApplication {

    public static final String INTENT_NAME = "HelloWorldIntent";

    private final MessageService messageService;

    public AlexaApplication(MessageService messageService) { <b class="conum">(2)</b>
        this.messageService = messageService;
    }

    @IntentHandler(INTENT_NAME) <b class="conum">(3)</b>
    public Optional&lt;Response&gt; greet(HandlerInput input) { <b class="conum">(4)</b>
        String speechText = messageService.sayHello();
        return input.getResponseBuilder()
                .withSpeech(speechText)
                .withSimpleCard("HelloWorld", speechText)
                .build();
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import com.amazon.ask.dispatcher.request.handler.HandlerInput
import com.amazon.ask.model.Response
import groovy.transform.CompileStatic
import io.micronaut.function.aws.alexa.AlexaIntents
import io.micronaut.function.aws.alexa.annotation.IntentHandler
import javax.inject.Singleton

@Singleton <b class="conum">(1)</b>
@CompileStatic
class AlexaApplication {

    private final MessageService messageService

    AlexaApplication(MessageService messageService) { <b class="conum">(2)</b>
        this.messageService = messageService
    }

    @IntentHandler("HelloWorldIntent") <b class="conum">(3)</b>
    Optional&lt;Response&gt; greet(HandlerInput input) { <b class="conum">(4)</b>
        String speechText = messageService.sayHello()
        return input.getResponseBuilder()
                .withSpeech(speechText)
                .withSimpleCard("HelloWorld", speechText)
                .build()
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import com.amazon.ask.dispatcher.request.handler.HandlerInput
import com.amazon.ask.model.Response
import io.micronaut.function.aws.alexa.AlexaIntents
import io.micronaut.function.aws.alexa.annotation.IntentHandler

import javax.inject.Singleton
import java.util.Optional

@Singleton <b class="conum">(1)</b>
class AlexaApplication(val messageService: MessageService) { <b class="conum">(2)</b>

    companion object {
        const val INTENT_NAME = "HelloWorldIntent"
    }

    @IntentHandler(INTENT_NAME) <b class="conum">(3)</b>
    fun greet(input : HandlerInput) : Optional&lt;Response&gt; { <b class="conum">(4)</b>
        val speechText = messageService.sayHello()
        return input.responseBuilder
                .withSpeech(speechText)
                .withSimpleCard("HelloWorld", speechText)
                .build()
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>javax.inject.Singleton</code> annotation is used to define <code>AlexApplication</code> as a bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Other services can be dependency injected into the constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/function/aws/alexa/annotation/IntentHandler.html">@IntentHandler</a> is used to indicate which methods are intent handlers</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The method receives a <code>HandlerInput</code> and returns a <code>Response</code></td>
</tr>
</table>
</div>

<h1 id="repository"><a class="anchor" href="#repository"></a>5 Repository</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-aws/edit/master/src/main/docs/guide/repository.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can find the source code of this project in this repository:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-aws">https://github.com/micronaut-projects/micronaut-aws</a></p>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>